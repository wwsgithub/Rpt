/*!
* search_suggest
* v 1.0.0
* svn ../ui/project/search_suggest/
* 2014-04-28 04:48
* [28,470,253] published at 2014-04-28 16:47:32
*/
!function(exports,undefined){var C={U:"undefined",E:function(){}};!function(a){for(var b,c=["error","info","log","warn"],d=c.length-1;d>=0;d--)b=c[d],a[b]=a[b]||C.E}(exports.console=exports.console||{}),console=exports.console;var doc=document,ua=function(){var a,b=!1,c=navigator.userAgent.match("MSIE ([0-9.]+)");return!window.ActiveXObject&&"ActiveXObject"in window?(b=!0,a=11):c&&c.length&&(b=!0,a=Number(c[1])),{isIe:b,version:a}}(),byId=function(a){return"string"==typeof a?doc.getElementById(a):a},byTag=function(a){return"string"==typeof a?doc.getElementsByTagName(a):a},byAttr=function(a,b,c){"string"==typeof a&&(a=byId(a));var d=[];c=c||"";for(var e=function(a){return a.getAttribute(b)},f=0,g=a.childNodes.length;g>f;f++)if(1==a.childNodes[f].nodeType){var h=!1;h=c?e(a.childNodes[f])==c:!!e(a.childNodes[f]),h&&d.push(a.childNodes[f]),a.childNodes[f].childNodes.length>0&&(d=d.concat(arguments.callee.call(null,a.childNodes[f],b,c)))}return d},hasClass=function(a,b){return a?a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)")):!1},addClass=function(a,b){hasClass(a,b)||(a.className=a.className.replace(/(^\s*)|(\s*$)/g,"")+" "+b)},removeClass=function(a,b){if(hasClass(a,b)){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")}},contains=function(a,b){try{return a.contains?a!=b&&a.contains(b):!!(16&a.compareDocumentPosition(b))}catch(c){}},create=function(a){return a=a.toUpperCase(),"TEXT"==a?doc.createTextNode(""):"BUFFER"==a?doc.createDocumentFragment():doc.createElement(a)},trim=function(a){return a.replace(/(^[\s\u3000]*)|([\s\u3000]*$)/g,"")},isFunction=function(a){return"function"==typeof a},isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},queryToJson=function(a,b){for(var c,d,e,f=trim(a).split("&"),g={},h=function(a){return b?decodeURIComponent(a):a},i=0,j=f.length;j>i;i++)f[i]&&(c=f[i].split("="),e=c[0],d=c[1],c.length<2&&(d=e,e="$nullName"),g[e]?(isArray(g[e])!==!0&&(g[e]=[g[e]]),g[e].push(h(d))):g[e]=h(d));return g},addEvent=function(a,b,c,d){if(a=byId(a),null==a)throw new Error("addEvent \u627E\u4E0D\u5230\u5BF9\u8C61\uFF1A"+a);return typeof d==C.U&&(d=!1),typeof b==C.U&&(b="click"),a.addEventListener?(a.addEventListener(b,c,d),!0):a.attachEvent?(a.attachEvent("on"+b,c),!0):void(a["on"+b]=c)},removeEvent=function(a,b,c){if(a=byId(a),null==a)throw"removeEvent \u627E\u4E0D\u5230\u5BF9\u8C61\uFF1A"+a;"function"==typeof c&&(typeof b==C.U&&(b="click"),a.addEventListener?a.removeEventListener(b,c,!1):a.attachEvent&&a.detachEvent("on"+b,c),c[b]=null)},domReady=function(){var a=[],b=0,c=0,d=function(){return"complete"===doc.readyState?1:c},e=function(){if(!c){if(c=1,a)for(;a.length;)a.shift()();a=null}},f=function(){b||(b=1,"complete"===doc.readyState?e():doc.addEventListener?(doc.addEventListener("DOMContentLoaded",function(){doc.removeEventListener("DOMContentLoaded",arguments.callee,!1),e()},!1),window.addEventListener("load",function(){window.removeEventListener("load",arguments.callee,!1),e()},!1)):(doc.attachEvent("onreadystatechange",function(){"complete"==doc.readyState&&(doc.detachEvent("onreadystatechange",arguments.callee),e())}),function(){if(!c){var a=new Image;try{a.doScroll(),a=null}catch(b){return void setTimeout(arguments.callee,64)}e()}}()))};return function(b){return f(),d()?void b.call():void a.push(b)}}(),delegatedEvent=function(){var a=function(a,b){for(var c=0,d=a.length;d>c;c+=1)if(contains(a[c],b))return!0;return!1},b=function(a){var b=C.E;for(var c in a)return b(c),!1;return!0};return function(c,d,e){d||(d=[]),isArray(d)&&(d=[d]);var f={};e=e||"action-type";var g=function(b){var g=b||window.event,h=g.target||g.srcElement,i=b.type;if(a(d,h))return!1;if(!contains(c,h))return!1;for(var j=null,k=function(){return f[i]&&f[i][j]?f[i][j]({evt:g,el:h,e:b,data:queryToJson(h.getAttribute("action-data")||"")}):!0};h&&h!==c&&h.getAttribute&&(j=h.getAttribute(e),k()!==!1);)h=h.parentNode},h={};return h.add=function(a,b,d){f[b]||(f[b]={},addEvent(c,b,g));var e=f[b];e[a]=d},h.remove=function(a,d){f[d]&&(delete f[d][a],b(f[d])&&(delete f[d],removeEvent(c,d,g)))},h.pushExcept=function(a){d.push(a)},h.removeExcept=function(a){if(a)for(var b=0,c=d.length;c>b;b+=1)d[b]===a&&d.splice(b,1);else d=[]},h.clearExcept=function(){d=[]},h.destroy=function(){for(var a in f){for(var b in f[a])delete f[a][b];delete f[a],removeEvent(c,g,a)}},h}}(),throttle=function(a,b,c){clearTimeout(a.__tId__),a.__tId__=setTimeout(function(){a.call(b)},c||100)},Clz=function(a){var b="___ytreporp___",c=function(){this.init.apply(this,arguments)};if(a){var d=C.E;d.prototype=a.prototype,c.prototype=new d}return c.prototype.init=C.E,c.prototype.set=function(a,c){this[b]||(this[b]={});for(var d,e=0,f=this[b],g=a.split("."),h=g.length,i=h-1;h>e;)d=g[e],e==i&&(f[d]=c),f[d]===undefined&&(f[d]={}),f=f[d],e++},c.prototype.get=function(a){this[b]||(this[b]={});for(var c,d=0,e=this[b],f=a.split("."),g=f.length,h=g-1;g>d;){if(c=f[d],d==h)return e[c];e[c]===undefined&&(e[c]={}),e=e[c],d++}},c.fn=c.prototype,c.fn.parent=c,c._super=c.__proto__,c.extend=function(a){var b=a.extended;for(var d in a)c[d]=a[d];b&&b(c)},c.include=function(a){var b=a.included;for(var d in a)c.fn[d]=a[d];b&&b(c)},c},getGuid=function(){return Math.abs((new Date).getTime())+"_"+Math.round(1e8*Math.random())},jsonp=function(url,param,cb,name){var head=byTag("head")[0],ojs=byId(url);ojs&&head.removeChild(ojs),url+=url.indexOf("?")>0?"&":"?",url=url+param+"&_t"+getGuid();var fun=exports.fun="jsonp_"+getGuid();"function"==typeof cb&&eval(fun+"=function(res){cb(res)}"),url=typeof name===C.U?url+"&callback="+fun:url+"&_cb="+fun;var js=create("script");js.src=url,js.id=url,js.type="text/javascript",js.language="javascript",head.appendChild(js)},setCursorPos=function(a,b){if(a.setSelectionRange)a.setSelectionRange(b,b),a.focus();else{var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}},config={requestURL:"http://s.weibo.com/ajax/jsonp/suggestion?Refer=sina_sug",searchURL:"http://s.weibo.com/weibo/@@key@@",interTime:6e5},MSG={a:"\u5927\u5BB6\u6B63\u5728\u641C\uFF1A\r\n",b:"\u8FDB\u5165\u641C\u7D22\u9996\u9875&gt;&gt;",c:"\u8BF7\u8F93\u5165\u5173\u952E\u5B57\r\n"},sugPrefix="top-suggest-",sugWrapcn=sugPrefix+"wrap",sugItemcn=sugPrefix+"item",sugtype=sugPrefix+"evt",getMsg=function(a,b,c){1e5==a.code&&a.data.length?isFunction(b)&&b(a.data):isFunction(c)&&c(a)},isShow=function(a){return isFunction(a)?a():a},$=new Clz;$.include({init:function(a){var b=this;b.input=a.input,b.maxLen=a.maxLen||10,b.onoff=a.onoff||"on",b.index=-1,b.cache={},b.onSelect=a.onSelect||C.E,b.randomKey=a.randomKey,b.defaultVal=a.defaultVal||"",b.placeholderStr=a.placeholderStr||MSG.c,b.firstFocus=!0,b.showHotList=a.showHotList||!0,b.showSuggestList=a.showSuggestList||!0;var c=b.input;if("off"===b.onoff)return!1;b.wrap=c.parentNode,c.setAttribute("autocomplete","off");var d=delegatedEvent(b.wrap);b.setCureent(null,-1),ua.isIe?domReady(function(){b.firstFocus&&b.getRandomKey()}):b.getRandomKey(),d.add(sugtype,"mouseover",function(a){var c=a.el;b.select(c)}),d.add(sugtype,"mouseout",function(a){var c=a.el,d=sugPrefix+"mover";c.className.indexOf(d)&&removeClass(c,d),!!b.cache.curItem&&removeClass(b.cache.curItem,d)}),d.add(sugtype,"mousedown",function(a){b.evtclick(a.el)}),addEvent(c,"focus",function(){b.sendRequest(),b.firstFocus=!1}),c.onpropertychange?c.onpropertychange=function(){b.sendRequest()}:ua.isIe&&ua.version>9?addEvent(window,"load",function(){addEvent(c,"input",function(){b.sendRequest()})}):addEvent(c,"input",function(){b.sendRequest()}),addEvent(c,"blur",function(){throttle(b.hide,b,200)}),addEvent(c,"keydown",function(a){b.keydownHandle(a)}),addEvent(c,"keyup",function(a){return a=a||exports.event,38==a.keyCode||40==a.keyCode||27==a.keyCode?!1:void b.sendRequest()})},sendRequest:function(){var a=this,b=a.getInputVal();if(a.setCureent(null,-1),a.sugWrap||(a.sugWrap=a.listRender()),""!==b){if(!isShow(a.showSuggestList))return;if(a.firstFocus)return;a.getSugData(config.requestURL,"key="+encodeURIComponent(b))}else{if(!isShow(a.showHotList))return;a.cache.hotList?(a.sugWrap.innerHTML=a.cache.hotList,a.innerToggle(!0)):a.getHotData(config.requestURL,"",!0)}},setCureent:function(a,b){var c=this;c.cache.curItem=a,c.cache.curIndex=b},hide:function(){var a=this;a.innerToggle(!1);var b=a.getInputVal();""!==b&&b!==a.placeholderStr},innerToggle:function(a){var b=this,c=b.sugWrap;typeof c!=C.U&&c&&(a?(c.style.display="block",b.cache.keyDownOff=!1):(c.style.display="none",b.cache.keyDownOff=!0))},getInputVal:function(){return trim(this.input.value)},evtclick:function(a){var b=this,c=a.innerHTML;b.input.value=c,isFunction(b.onSelect)&&b.onSelect()},keydownHandle:function(){var a,b=this,c=arguments[0]||exports.event,d=b.curMaxLen||b.maxLen;if(b.cache.keyDownOff)return!1;switch(c.keyCode){case 38:a=-1===b.cache.curIndex?d-1:b.cache.curIndex-1,b.select(a,!0);break;case 40:a=-1===b.cache.curIndex?0:b.cache.curIndex===d-1?-1:b.cache.curIndex+1,b.select(a,!0);break;case 13:}},select:function(a,b){var c,d,e=this,f=sugPrefix+"mover",g=e.cache.curItem;"object"==typeof a?(c=a,d=+c.getAttribute("index")):-1===a?(c=null,d=-1):(c=byAttr(e.sugWrap,"index",a+"")[0],d=+a),g&&removeClass(g,f),c?(addClass(c,f),e.cache.curItem=c,e.cache.curIndex=d,b&&(e.input.value=c.innerHTML)):(e.input.value=e.cache.curVal,e.cache.curItem=null,e.cache.curIndex=-1),setTimeout(function(){setCursorPos(e.input,e.input.value.length)},-1)},listRender:function(){var a=this,b=a.input;if(!b)throw new Error("input is undefined!");if(isShow(a.showHotList))return a.sugWrap=create("div"),a.sugWrap.className=sugWrapcn,a.innerToggle(!1),b.value="",a.cache.hotList?a.sugWrap.innerHTML=a.cache.hotList:a.getHotData(config.requestURL,"",!0),a.wrap.appendChild(a.sugWrap),setInterval(function(){a.getHotData(config.requestURL,"",!1)},config.interTime),a.sugWrap},getHotData:function(a,b,c){var d=this,e=function(a){getMsg(a,function(a){c?(d.cache.hotList=d.sugWrap.innerHTML=d.render(a,"hot"),d.innerToggle(!0)):d.cache.hotList=d.render(a,"hot",!0)},function(){d.innerToggle(!1)})};jsonp(a,b,e,"_cb")},getSugData:function(a,b){var c=this,d=function(a){getMsg(a,function(a){""!==c.getInputVal()&&(c.sugWrap.innerHTML=c.render(a,"suggest"),c.innerToggle(!0))},function(){c.innerToggle(!1)})};jsonp(a,b,d,"_cb")},getRandomKey:function(){var a=this,b=a.input;if(a.randomKey===!1)return void(a.defaultVal&&(b.value=a.defaultVal,a.cache.keyDownOff=!0));var c=function(a,b){return Math.floor(a+Math.random()*(b-a))},d=function(d){getMsg(d,function(d){var e=d.length,f=c(0,e-1);b.value=d[f],a.cache.keyDownOff=!0},function(){b.value=MSG.c})};jsonp(config.requestURL,"",d,"_cb")},render:function(a,b,c){var d=this,e=[],f="suggestion",g="",h="",i=a.length>d.maxLen?d.maxLen:a.length;c||(d.curMaxLen=i,d.cache.curVal=d.input.value),"hot"===b&&(f="word",g='<div class="top-suggest-tip">'+MSG.a+"</div>",h='<div class="top-suggest-more clearfix"><a href="http://search.sina.com.cn/?channel=channel" target="_blank" class="top-suggest-toHomePage">'+MSG.b+"</a></div>"),e.push(g);for(var j=0;i>j;j++)e.push('<div class="'+sugItemcn+'" index="'+j+'" action-type="'+sugtype+'">'+a[j]+"</div>");return e.push(h),e.join("")}}),$.util={},$.util.domReady=domReady;var EXPORTS_NAME="searchsUggest",UGLIFY_NAME="___"+EXPORTS_NAME+"___";exports[UGLIFY_NAME]=$,exports[EXPORTS_NAME]||(exports[EXPORTS_NAME]=$)}(window);